@forward '../shared/markdown-container';
@forward '../shared/markdown-anchor';

$img-embed-sel: '.mod-header + div + div > p > .image-embed:nth-child(1 of .image-embed)';

body {
    --banner-height: 300px;
    --banner-title-shadow: 0px 0px 0.1em rgb(var(--mono-rgb-0)), 0px 0px 0.2em rgb(var(--mono-rgb-0)), 0px 0px 0.5em rgb(var(--mono-rgb-0));
    --banner-slope-angle: 4deg;
    --banner-slope-border-width: 5px;
    --banner-slope-border-color: var(--color-accent);
    --banner-width: calc(100cqw + 2 * var(--file-margins));
}

.markdown-preview-view.banner {
    --inline-title-margin-bottom: 0;

    #{$img-embed-sel} {
        --image-shadow-offset: 0;
        display: block;

        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;

        width: var(--banner-width);
        height: var(--banner-height);


        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        + br {
            display: none;
        }
    }

    .inline-title {
        text-shadow: var(--banner-title-shadow);
    }

}

// Properties hidden
.markdown-preview-view:not(.show-properties).banner .mod-header,
.markdown-preview-view.hide-properties.banner .mod-header {
    height: calc(var(--banner-height) - var(--file-margins));
    padding-bottom: var(--file-margins);
}

// Properties visible
@container not style(--metadata-display-reading: none) {
    .markdown-preview-view.show-properties.banner {
        .metadata-container {
            margin-top: calc(var(--banner-height) - var(--file-margins) + 4px + 0.8em);
        }
    }
}

.markdown-preview-view.banner.banner-gradient {
    #{$img-embed-sel} {
        -webkit-mask-image: linear-gradient(to bottom, black var(--file-margins), transparent);
    }
}

.markdown-preview-view.banner.banner-title {
    --inline-title-line-height: 3;
    
    .inline-title {
        position: absolute;
        top: calc(var(--banner-height) * 0.5);
        right: 50%;
        transform: translate(50%, -50%);
        display: block;
        border: 1px solid var(--color-base-50);
        min-width: 50%;
        background-color: rgba(var(--mono-rgb-0), 0.4);
        backdrop-filter: blur(5px);
        text-shadow: none;
        text-align: center;
    }
}

.markdown-preview-view.banner.banner-slant,
.markdown-preview-view.banner.banner-slope {
    --inline-title-size: 4em;
    --inline-title-line-height: 1.5;

    --banner-angle-diag: calc(var(--banner-width) * sin(var(--banner-slope-angle)));
    --banner-angle-height: calc(var(--banner-angle-diag) / sin(90deg - var(--banner-slope-angle)));

    #{$img-embed-sel} {
        clip-path: polygon(0 0, 100% 0, 100% calc(100% - var(--banner-angle-height)), 0 100%);
        background-color: var(--banner-slope-border-color);

        img {
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - var(--banner-angle-height) - var(--banner-slope-border-width)), 0 calc(100% - var(--banner-slope-border-width)));
        }
    }

    .inline-title {
        position: absolute;
        transform: rotate(calc(-1 * var(--banner-slope-angle))) translateY(-100%);
        top: calc(anchor(--anchor-preview-section top) + var(--banner-height) - (50% + 50cqw) * sin(var(--banner-slope-angle)) / sin(90deg - var(--banner-slope-angle)) - 10px);
        right: anchor(--anchor-preview-section right, var(--file-margins));
    }
}